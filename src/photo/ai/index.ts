/* eslint-disable max-len */

export type AiAutoGeneratedField =
  'title' |
  'caption' |
  'tags' |
  'semantic'

export const ALL_AI_AUTO_GENERATED_FIELDS: AiAutoGeneratedField[] = [
  'title',
  'caption',
  'tags',
  'semantic',
];

export const parseAiAutoGeneratedFieldsText = (
  text = 'all',
): AiAutoGeneratedField[] => {
  const textFormatted = text.trim().toLocaleLowerCase();
  if (textFormatted === 'none') {
    return [];
  } else if (textFormatted === 'all') {
    return ALL_AI_AUTO_GENERATED_FIELDS;
  } else {
    const fields = textFormatted
      .toLocaleLowerCase()
      .split(',')
      .map(field => field.trim())
      .filter(field => ALL_AI_AUTO_GENERATED_FIELDS
        .includes(field as AiAutoGeneratedField));
    return fields as AiAutoGeneratedField[];
  }
};

export type AiImageQuery =
  'title' |
  'caption' |
  'title-and-caption' |
  'tags' |
  'description-small' |
  'description' |
  'description-large' |
  'description-semantic';

export const PHOTO_GENRES = ['portrait', 'street', 'landscape', 'events'] as const;
export type PhotoGenre = typeof PHOTO_GENRES[number];

export const AI_IMAGE_QUERIES: Record<AiImageQuery, string> = {
  'title': 'Write a poetic and emotionally evocative title for this image in both English and Chinese. Focus on the mood, atmosphere, and feelings the image evokes. Format: "English Title | 中文标题". Keep each title within 5 words.',
  'caption': 'Write a poetic and emotionally resonant caption for this image in both English and Chinese. Focus on the mood, atmosphere, and feelings. Format: "English Caption | 中文说明". Keep each caption within 8 words.',
  'title-and-caption': 'Write a poetic title and caption for this image in both English and Chinese. Focus on the mood, atmosphere, and feelings. Format: Title: "English Title | 中文标题" Caption: "English Caption | 中文说明". Keep titles within 5 words and captions within 8 words.',
  'tags': 'First, identify which one of these genres best fits this image: portrait, street, landscape, events. Then, generate a comma-separated list of 10 tags, mixing English and Chinese naturally. Start with the identified genre, then add more specific descriptive tags. Example: "street, 街头, night market, 夜市, neon lights, 霓虹灯, crowd, 人群, urban life, 城市生活"',
  'description-small': 'Describe this image succinctly without the initial text "This image shows" or "This is a picture of"',
  'description': 'Describe this image',
  'description-large': 'Describe this image in detail',
  'description-semantic': 'List up to 5 things in this image without description as a comma-separated list',
};

export const parseTitleAndCaption = (text: string) => {
  const matches = text.includes('Title')
    ? text.match(/^[`'"]*Title: ["']*(.*?)["']*[ ]*Caption: ["']*(.*?)\.*["']*[`'"]*$/)
    : text.match(/^(.*?): (.*?)$/);

  return {
    title: matches?.[1]?.trim() ?? '',
    caption: matches?.[2]?.trim() ?? '',
  };
};

export const parseBilingualTags = (text: string): string[] => {
  return text.split(',').map(t => t.trim());
};

export const cleanUpAiTextResponse = (text: string) =>
  text
    .replaceAll('\n', ' ')
    .replaceAll('"', '')
    .replace(/\.$/, '');
